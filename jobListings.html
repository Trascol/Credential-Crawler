<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Employers</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
        <script src="assets/js/loginFunc.js" defer></script>
        <style>

            .modal {
                display: none;
                position: fixed;
                z-index: 100;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                justify-content: center;
                align-items: center;
            }
            
            .modal-content {
                position: relative;
                background: #0b161a;
                color: #fff;
                padding: 3em;
                border-radius: 20px;
                border: 2px solid #00ed64;
                box-shadow: 0 0 25px rgba(0, 237, 100, 0.4);
                max-width: 900px;
                width: 95%;
                max-height: 90vh;
                overflow-y: auto;
                overflow-x: hidden;
                font-family: inherit;
                text-align: left;
                font-size: 1.1em;
            }
            
            /* Headings */
            .modal-content h2,
            .modal-content h3 {
                color: #00ed64;
                text-align: center;
                margin-bottom: 1em;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-weight: bold;
            }
            
            /* Paragraphs, links, spans */
            .modal-content p,
            .modal-content span,
            .modal-content a {
                color: #e9fbe9;
                line-height: 1.8;
                font-size: 1.05em;
                font-weight: 500;
            }
            
            /* Strong tags */
            .modal-content strong {
                color: #ffffff;
                font-weight: 700;
            }
            
            /* Links */
            .modal-content a {
                color: #00ed64;
                text-decoration: underline;
            }
            
            /* Close Button */
            #close-modal {
                position: absolute;
                top: 20px;
                right: 20px;
                transform: translate(50%, -50%);
                font-size: 2rem;
                color: #ff4c4c;
                background: transparent;
                border: none;
                font-weight: bold;
                cursor: pointer;
                z-index: 1001;
            }
            
            /* Scrollbar styling */
            .modal-content::-webkit-scrollbar {
                width: 10px;
            }
            .modal-content::-webkit-scrollbar-thumb {
                background-color: #00ed64;
                border-radius: 10px;
            }
            .modal-content::-webkit-scrollbar-track {
                background-color: #0b161a;
            }
            
            /* Pills for skills */
            .skill-pill {
                display: inline-block;
                background: #00ed64;
                color: #0b161a;
                padding: 0.3em 0.6em;
                margin: 0.3em 0.2em;
                border-radius: 20px;
                font-size: 0.9em;
                font-weight: 600;
            }
            .skill-pill.missing {
                background: #ff8080;
                color: #fff;
            }
            
            /* Job cards */
            .job-card {
                background-color: #ffffff10;
                border: 1px solid #00ed64;
                border-radius: 20px;
                padding: 2em;
                margin: 1em auto;
                color: #e9fbe9;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
                text-align: center;
                position: relative;
                width: 95%;
                max-width: 800px;
            }
            .job-card strong {
                color: #fff;
                display: block;
                margin-bottom: 0.5em;
            }
            .job-card span {
                color: #ccc;
            }
            .job-card:hover {
                transform: scale(1.02);
                box-shadow: 0 0 12px #00ed64, inset 0 0 0 1px #00ed64;
            }

            .skill-pill {
                background: #00ed64;
                color: black;
                padding: 4px 10px;
                border-radius: 20px;
                margin: 3px;
                display: inline-block;
                font-weight: bold;
            }
            
            .skill-pill.missing {
                background: #ff4c4c;
                color: white;
            }
            
</style>

        </style>
	</head>

	<body class="no-sidebar is-preload">

		<div id="page-wrapper">

			<!-- Header -->
			<section id="header">
				<div class="container">

					<!-- Logo -->
                    <div class="logged_in" style="top: 1%;">
						<span id="user-name"></span>
						<a href="#" id="logout-btn">Logout</a>
					</div>
                        <!-- Main -->
				<section id="main">

					<div class="container">
                        <h1 class="joblistings-title"><span>Job Listings</span></h1>
                        <p class="joblistings-description">
                          Browse current openings and view details for each job. Click on a listing to see full qualifications and apply.
                        </p>
                        <div id="job-listings"></div>
                      </div>
                      
                
                    <!-- Modal -->
                    <div id="job-modal" class="modal">
                        <div class="modal-content" id="modal-content">
                          <button id="close-modal">&times;</button>
                          <div id="job-details"></div>
                        </div>
                      </div>
                      
                      
									
				</section>
					<!-- Nav -->
						<nav id="nav">
							<ul>
                                <li><a class="icon solid fa-home" style="color: #fff" href="index.html"><span>Home</span></a></li>
                                <li><a class="icon solid fa-user-tie" style="color: #fff" href="jobseekerupload.html"><span>Check Your Resume</span></a></li>
                                <li><a class="icon solid fa-building" style="color: #fff" href="jobListings.html"><span>View Job Listings</span></a></li>
                                <li><a class="icon solid fa-building" style="color: #fff" href="employerjobposting.html"><span>Add a Job Listing</span></a></li>
                                <li><a class="icon solid fa-building" style="color: #fff" href="employerResumeCheck.html"><span>Check Applicant Resumes</span></a></li>
                                <li><a class="icon solid fa-envelope" style="color: #fff" href="contact.html"><span>Contact Us</span></a></li>
                            </ul>
						</nav>

				</div>
			</section>




			<!-- Footer -->
			<section id="footer">
				<!-- Nav -->
				<nav id="nav">
					<ul>
                        <li><a class="icon solid fa-home" style="color: #fff" href="index.html"><span>Home</span></a></li>
                        <li><a class="icon solid fa-user-tie" style="color: #fff" href="jobseekerupload.html"><span>Check Your Resume</span></a></li>
                        <li><a class="icon solid fa-building" style="color: #fff" href="jobListings.html"><span>View Job Listings</span></a></li>
                        <li><a class="icon solid fa-building" style="color: #fff" href="employerjobposting.html"><span>Add a Job Listing</span></a></li>
                        <li><a class="icon solid fa-building" style="color: #fff" href="employerResumeCheck.html"><span>Check Applicant Resumes</span></a></li>
                        <li><a class="icon solid fa-envelope" style="color: #fff" href="contact.html"><span>Contact Us</span></a></li>
                    </ul>
				</nav>
				
					</div>
				</div>
			</section>

	</div>

			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
            <script>

                async function checkMatch(jobId) {
                    const user = JSON.parse(localStorage.getItem("user"));
                    if (!user?.user_id) return alert("You must be logged in.");
                
                    try {
                        const res = await fetch(`https://credential-crawler-backend.onrender.com/evaluate-resume-against-job/${user.user_id}/${jobId}`);
                        const result = await res.json();
                        const output = document.getElementById(`match-result-${jobId}`);
                        output.style.display = 'block';
                
                        if (res.ok) {
                            const fieldMatchColor = result.field_match ? '#00ed64' : '#ff4c4c';
                            const fieldMatchText = result.field_match ? '✅ Field Match!' : '❌ Field Mismatch';
                
                            output.innerHTML = `
                                <div class="match-output">
                                    <strong>Resume’s Most Likely Field:</strong> <span style="color:#00ed64">${result.resume_field}</span><br>
                                    <strong>Job Listing Field:</strong> <span>${result.job_field}</span><br>
                                    <strong style="color:${fieldMatchColor};">${fieldMatchText}</strong><br><br>
                                    
                                    <strong>Matched Skills:</strong><br>
                                    ${result.matched_skills.map(skill => `<span class="skill-pill">${skill}</span>`).join(" ") || "<em>None</em>"}<br><br>
                                    
                                    <strong>Missing Skills:</strong><br>
                                    ${result.missing_skills.map(skill => `<span class="skill-pill missing">${skill}</span>`).join(" ") || "<em>None</em>"}
                                </div>
                            `;
                        } else {
                            output.innerHTML = `<em>${result.error || "Unable to evaluate resume."}</em>`;
                        }
                    } catch (err) {
                        console.error("Match error:", err);
                    }
                }

                const listingsDiv = document.getElementById("job-listings");
                const modal = document.getElementById("job-modal");
                const jobDetails = document.getElementById("job-details");
                const closeModal = document.getElementById("close-modal");
        
                fetch("https://credential-crawler-backend.onrender.com/get-jobs")
                    .then(res => res.json())
                    .then(jobs => {
                        jobs.forEach(job => {
                            const div = document.createElement("div");
                            div.className = "job-card";
                            div.innerHTML = `
                                <strong>${job.job_title}</strong> at ${job.company_name}<br>
                                ${job.city}, ${job.state}<br>
                                <span><strong>Salary:</strong> ${job.salary}</span>
                            `;
                            div.addEventListener("click", () => {
                                jobDetails.innerHTML = `
                                    <h2>${job.job_title}</h2>
                                    <p><strong>Company:</strong> ${job.company_name}</p>
                                    <p><strong>Location:</strong> ${job.city}, ${job.state}</p>
                                    <p><strong>Field:</strong> ${job.field_name}</p>
                                    <p><strong>Work Setting:</strong> ${job.work_setting}</p>
                                    <p><strong>Salary:</strong> ${job.salary}</p>
                                    <p><strong>Job Description:</strong> ${job.job_description}</p>
                                    <p><strong>Required Qualifications:</strong> ${job.required_qualifications}</p>
                                    <p><strong>Preferred Qualifications:</strong> ${job.preferred_qualifications || "None"}</p>
                                    <p><strong>Benefits:</strong> ${job.benefits?.join(", ") || "None"}</p>
                                    <p><strong>Apply Here:</strong> <a href="${job.application_link}" target="_blank">${job.application_link}</a></p>
                                    <p><em>Posted at: ${new Date(job.posted_at).toLocaleString()}</em></p>
                                    <div style="text-align:center; margin-top: 1.5em;">
                                    <button onclick="checkMatch(${job.id})" style="margin: 0 auto;">Check My Resume Match</button>
                                    </div>
                                    <div id="match-result-${job.id}" class="match-output" style="margin-top:1em;"></div>
                                `;
                                modal.style.display = "flex";
                            });
                            listingsDiv.appendChild(div);
                        });
                    });
        
                closeModal.addEventListener("click", () => modal.style.display = "none");
                window.addEventListener("click", e => {
                    if (e.target === modal) modal.style.display = "none";
                });
            </script>
	</body>
</html>