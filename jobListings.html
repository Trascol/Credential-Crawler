<!DOCTYPE html>
<html>
<head>
    <title>Job Listings</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        .job-card {
            border: 1px solid #ccc;
            padding: 1rem;
            margin: 1rem 0;
            cursor: pointer;
            border-radius: 6px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Job Listings</h1>
        <div id="job-listings"></div>
    </div>

    <!-- Modal -->
    <div id="job-modal" class="modal">
        <div class="modal-content" id="modal-content">
            <button id="close-modal" style="float:right;">&times;</button>
            <div id="job-details"></div>
        </div>
    </div>

    <script>
        const listingsDiv = document.getElementById("job-listings");
        const modal = document.getElementById("job-modal");
        const jobDetails = document.getElementById("job-details");
        const closeModal = document.getElementById("close-modal");

        fetch("https://credential-crawler-backend.onrender.com/get-jobs")
            .then(res => res.json())
            .then(jobs => {
                jobs.forEach(job => {
                    const div = document.createElement("div");
                    div.className = "job-card";
                    div.innerHTML = `
                        <strong>${job.job_title}</strong> at ${job.company_name}<br>
                        ${job.city}, ${job.state}<br>
                        <span><strong>Salary:</strong> ${job.salary}</span>
                    `;
                    div.addEventListener("click", () => {
                        jobDetails.innerHTML = `
                            <h2>${job.job_title}</h2>
                            <p><strong>Company:</strong> ${job.company_name}</p>
                            <p><strong>Location:</strong> ${job.city}, ${job.state}</p>
                            <p><strong>Field:</strong> ${job.field_name}</p>
                            <p><strong>Work Setting:</strong> ${job.work_setting}</p>
                            <p><strong>Salary:</strong> ${job.salary}</p>
                            <p><strong>Job Description:</strong> ${job.job_description}</p>
                            <p><strong>Required Qualifications:</strong> ${job.required_qualifications}</p>
                            <p><strong>Preferred Qualifications:</strong> ${job.preferred_qualifications || "None"}</p>
                            <p><strong>Benefits:</strong> ${job.benefits?.join(", ") || "None"}</p>
                            <p><strong>Apply Here:</strong> <a href="${job.application_link}" target="_blank">${job.application_link}</a></p>
                            <p><em>Posted at: ${new Date(job.posted_at).toLocaleString()}</em></p>
                        `;
                        modal.style.display = "flex";
                    });
                    listingsDiv.appendChild(div);
                });
            });

        closeModal.addEventListener("click", () => modal.style.display = "none");
        window.addEventListener("click", e => {
            if (e.target === modal) modal.style.display = "none";
        });
    </script>
</body>
</html>
